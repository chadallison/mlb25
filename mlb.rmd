---
title: "Chad's 2025 MLB Report"
output: github_document
knit: (function(input, ...) { rmarkdown::render(input, output_file = "README.md", envir = globalenv()) })
---

*Interested in the underlying code that builds this report?* Check it out on GitHub: [mlb25](https://github.com/chadallison/mlb25){target="_blank"}

___

### Contents

- [Team Standings]
- [Runs Scored and Allowed per Game]

___

```{r fold_code, include = F}
knitr::knit_hooks$set(source = function(x, options) {
    hook.r = function(x, options) {
      fence = "```"
      language = tolower(options$engine)
      if (language == "node") language = "javascript"
      if (!options$highlight) language = "text"
      if (!is.null(options$fold_code)) {
        paste0("\n\n", "<details><summary>View Code</summary>\n", fence, language,
               "\n", x, fence, "\n\n", "</details>\n")
      } else paste0('\n\n', fence, language, '\n', x, fence,  '\n\n')
    }
    x = knitr:::hilight_source(x, "markdown", options)
    hook.r(paste(c(x, ""), collapse = "\n"), options)
})
```

```{r message = F, warning = F, include = F, fold_code = T}
library(tidyverse)
library(tvthemes)
library(janitor)
library(glue)
library(zoo)
library(baseballr)

theme_custom = theme_avatar() +
  theme(plot.title = element_text(hjust = 0.5),
        plot.subtitle = element_text(hjust = 0.5, size = 9, vjust = 2.5, face = "italic"),
        plot.caption = element_text(face = "italic"),
        panel.grid.major = element_line(linewidth = 0.5, colour = "#DFDAD1"),
        panel.grid.minor = element_line(linewidth = 0.5, colour = "#DFDAD1"))

theme_set(theme_custom)
```

```{r message = F, warning = F, include = F}
end_games_raw = mlb_schedule(season = 2025, level_ids = "1")

end_games = end_games_raw |>
  filter(series_description == "Regular Season" & status_detailed_state == "Final") |>
  select(date, game_pk, away_score = teams_away_score, away_team = teams_away_team_name,
         home_team = teams_home_team_name, home_score = teams_home_score) |>
  filter(!is.na(away_score) & !is.na(home_score)) |>
  mutate(win_team = ifelse(home_score > away_score, home_team, away_team),
         lose_team = ifelse(home_score > away_score, away_team, home_team),
         win_score = ifelse(home_score > away_score, home_score, away_score),
         lose_score = ifelse(home_score > away_score, away_score, home_score))

# writing and reading prevents baseballr message
write_csv(end_games, "data/end_games.csv")
end_games = read_csv("data/end_games.csv", show_col_types = F)
```

```{r include = F}
all_teams = sort(unique(c(end_games$home_team, end_games$away_team)))

team_abbrevs =  c(
  "ARI", "ATH", "ATL", "BAL", "BOS", "CHC",
  "CWS", "CIN", "CLE", "COL", "DET", "HOU",
  "KC", "LAA", "LAD", "MIA", "MIL", "MIN",
  "NYM", "NYY", "PHI", "PIT", "SD", "SF",
  "SEA", "STL", "TB", "TEX", "TOR", "WSH"
)


team_hex = c(
  "#A71930", "#003831", "#CE1141", "#DF4601", "#BD3039", "#0E3386",
  "#27251F", "#C6011F", "#0C2340", "#33006F", "#FA4616", "#EB6E1F",
  "#004687", "#BA0021", "#005A9C", "#00A3E0", "#FFC52F", "#D31145",
  "#002D72", "#003087", "#E81828", "#FDB827", "#2F241D", "#FD5A1E",
  "#0C2C56", "#C41E3A", "#8FBCE6", "#C0111F", "#134A8E", "#AB0003"
)


divisions <- c(
  "NL West", "AL West", "NL East", "AL East", "AL East", "NL Central",
  "AL Central", "NL Central", "AL Central", "NL West", "AL Central", "AL West",
  "AL Central", "AL West", "NL West", "NL East", "NL Central", "AL Central",
  "NL East", "AL East", "NL East", "NL Central", "NL West", "NL West",
  "AL West", "NL Central", "AL East", "AL West", "AL East", "NL East"
)


team_divisons = data.frame(team = all_teams, division = divisions) |>
  mutate(division = factor(division, levels = c("AL West", "AL Central", "AL East",
                                                "NL West", "NL Central", "NL East")))

teams_info = data.frame(team = all_teams, abb = team_abbrevs, hex = team_hex)

better_date = function(dt) {
  return(paste0(month(dt, label = T, abbr = F), " ", day(dt), ", ", year(dt)))
}
```

### Team Standings

```{r echo = F}
team_wins = end_games |>
  count(win_team, name = "wins")

team_losses = end_games |>
  count(lose_team, name = "losses")

team_records = team_wins |>
  full_join(team_losses, by = c("win_team" = "lose_team")) |>
  mutate(wins = coalesce(wins, 0),
         losses = coalesce(losses, 0),
         gp = wins + losses,
         win_pct = round(wins / gp * 100, 2),
         record = as.character(glue("{wins}-{losses}"))) |>
  rename(team = win_team) |>
  inner_join(teams_info, by = "team")

team_records |>
  ggplot(aes(reorder(reorder(team, win_pct), wins), win_pct)) +
  geom_col(aes(fill = team), show.legend = F) +
  geom_text(aes(label = record), size = 3, hjust = -0.2) +
  coord_flip(ylim = c(0, max(team_records$win_pct) * 1.05)) +
  scale_fill_manual(values = team_hex) +
  labs(x = NULL, y = NULL, title = "2025 MLB Standings") +
  theme(axis.text.x = element_blank())
```

___

### Runs Scored and Allowed per Game

```{r echo = F}
home_scored_allowed = end_games |>
  select(date, team = home_team, scored = home_score, allowed = away_score) |>
  mutate(home_away = "home")

away_scored_allowed = end_games |>
  select(date, team = away_team, scored = away_score, allowed = home_score) |>
  mutate(home_away = "away")

team_scored_allowed = bind_rows(home_scored_allowed, away_scored_allowed) |>
  arrange(team, date)

team_rspg_rapg = team_scored_allowed |>
  group_by(team) |>
  summarise(rspg = sum(scored) / n(),
            rapg = sum(allowed) / n())

team_rspg_rapg |>
  inner_join(teams_info, by = "team") |>
  ggplot(aes(rspg, rapg)) +
  geom_point(aes(col = team), shape = "square", size = 4, show.legend = F) +
  geom_vline(xintercept = mean(team_rspg_rapg$rspg), linetype = "dashed", alpha = 0.5) +
  geom_hline(yintercept = mean(team_rspg_rapg$rapg), linetype = "dashed", alpha = 0.5) +
  scale_color_manual(values = team_hex) +
  ggrepel::geom_text_repel(aes(label = abb), size = 3, max.overlaps = 30) +
  labs(x = "Runs Scored per Game", y = "Runs Allowed Per Game",
       title = glue("Team Runs Scored/Allowed per Game as of {better_date(Sys.Date())}")) +
  scale_x_continuous(breaks = seq(0, 15, by = 1)) +
  scale_y_continuous(breaks = seq(0, 15, by = 1))
```

___

### More to come as the season goes on!

___

































































